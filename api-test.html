<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIæ¥å£æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #1e1e1e;
            color: #ffffff;
            margin: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-button {
            background-color: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .test-button:hover {
            background-color: #45a049;
        }
        .test-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .output {
            background-color: #2d2d2d;
            border: 1px solid #555;
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
            min-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196F3; }
        .summary {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background-color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ APIæ¥å£è‡ªåŠ¨æµ‹è¯•</h1>
            <p>æµ‹è¯•ç›®æ ‡: http://118.107.4.158:1337</p>
        </div>
        
        <div style="text-align: center;">
            <button class="test-button" onclick="runTests()" id="testBtn">å¼€å§‹æµ‹è¯•</button>
            <button class="test-button" onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
        </div>
        
        <div class="output" id="output"></div>
        <div class="summary" id="summary" style="display: none;"></div>
    </div>

    <script>
        const BASE_URL = 'http://118.107.4.158:1337';
        
        // æµ‹è¯•æ¥å£åˆ—è¡¨
        const apiTests = [
            { name: 'è®¤è´­è®¡åˆ’', url: '/api/subscription-plans' },
            { name: 'æŠ½å¥–é…ç½®', url: '/api/lottery-configs' },
            { name: 'æŠ½å¥–å¥–å“', url: '/api/lottery-prizes' },
            { name: 'å•†åŸå•†å“', url: '/api/store-products' },
            { name: 'ç”¨æˆ·åˆ—è¡¨', url: '/api/users' },
            { name: 'é’±åŒ…ä½™é¢', url: '/api/wallet-balances' },
            { name: 'é’±åŒ…äº¤æ˜“', url: '/api/wallet-txes' },
            { name: 'è®¤è´­è®¢å•', url: '/api/subscription-orders' },
            { name: 'æ¨èå¥–åŠ±', url: '/api/referral-rewards' },
            { name: 'å……å€¼åœ°å€', url: '/api/deposit-addresses' },
            { name: 'æç°ç”³è¯·', url: '/api/withdraw-requests' },
            { name: 'æŠ½å¥–è®°å½•', url: '/api/lottery-spins' },
            { name: 'å•†åŸè®¢å•', url: '/api/shop-orders' }
        ];
        
        // æµ‹è¯•ç»“æœ
        let passed = 0;
        let failed = 0;
        let errors = [];
        
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'success' ? 'success' : 
                             type === 'error' ? 'error' : 
                             type === 'warning' ? 'warning' : 'info';
            output.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        async function testAPI(api) {
            try {
                log(`ğŸ§ª æµ‹è¯•: ${api.name}`, 'info');
                const response = await fetch(`${BASE_URL}${api.url}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… ${api.name} - é€šè¿‡ (${response.status})`, 'success');
                    if (data.data) {
                        log(`   æ•°æ®é‡: ${data.data.length}`, 'info');
                    }
                    passed++;
                } else {
                    log(`âŒ ${api.name} - å¤±è´¥ (${response.status})`, 'error');
                    failed++;
                    errors.push({ name: api.name, status: response.status });
                }
            } catch (error) {
                log(`âŒ ${api.name} - ç½‘ç»œé”™è¯¯`, 'error');
                failed++;
                errors.push({ name: api.name, error: 'ç½‘ç»œé”™è¯¯' });
            }
        }
        
        async function testRegisterAPI() {
            try {
                log('ğŸ§ª æµ‹è¯•: æ³¨å†Œæ¥å£', 'info');
                const response = await fetch(`${BASE_URL}/api/wallet/auth/invite-register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'testuser',
                        email: 'test@example.com',
                        password: 'testpass123',
                        inviteCode: 'user'
                    })
                });
                
                if (response.ok) {
                    log(`âœ… æ³¨å†Œæ¥å£ - é€šè¿‡ (${response.status})`, 'success');
                    passed++;
                } else if (response.status === 400) {
                    log('âœ… æ³¨å†Œæ¥å£ - è·¯ç”±å­˜åœ¨ (400 - å‚æ•°éªŒè¯)', 'success');
                    passed++;
                } else {
                    log(`âŒ æ³¨å†Œæ¥å£ - å¤±è´¥ (${response.status})`, 'error');
                    failed++;
                    errors.push({ name: 'æ³¨å†Œæ¥å£', status: response.status });
                }
            } catch (error) {
                log('âŒ æ³¨å†Œæ¥å£ - ç½‘ç»œé”™è¯¯', 'error');
                failed++;
                errors.push({ name: 'æ³¨å†Œæ¥å£', error: 'ç½‘ç»œé”™è¯¯' });
            }
        }
        
        async function runTests() {
            // é‡ç½®ç»“æœ
            passed = 0;
            failed = 0;
            errors = [];
            
            // ç¦ç”¨æŒ‰é’®
            document.getElementById('testBtn').disabled = true;
            document.getElementById('testBtn').textContent = 'æµ‹è¯•ä¸­...';
            
            // æ¸…ç©ºè¾“å‡º
            clearOutput();
            
            log('ğŸš€ å¼€å§‹APIæ¥å£æµ‹è¯•...', 'info');
            log(`ğŸ“ æµ‹è¯•ç›®æ ‡: ${BASE_URL}`, 'info');
            log('', 'info');
            
            // æµ‹è¯•GETæ¥å£
            for (const api of apiTests) {
                await testAPI(api);
                await new Promise(resolve => setTimeout(resolve, 100)); // å»¶è¿Ÿ100ms
            }
            
            // æµ‹è¯•æ³¨å†Œæ¥å£
            await testRegisterAPI();
            
            // ç»“æœæ±‡æ€»
            log('', 'info');
            log('ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»:', 'info');
            log(`âœ… é€šè¿‡: ${passed}`, 'success');
            log(`âŒ å¤±è´¥: ${failed}`, 'error');
            log(`ğŸ“ˆ æˆåŠŸç‡: ${((passed / (passed + failed)) * 100).toFixed(1)}%`, 'info');
            
            if (errors.length > 0) {
                log('', 'info');
                log('âŒ å¤±è´¥è¯¦æƒ…:', 'error');
                errors.forEach(({ name, status, error }) => {
                    log(`   ${name}: ${status || error}`, 'error');
                });
            }
            
            log('', 'info');
            if (failed === 0) {
                log('ğŸ‰ æ‰€æœ‰APIæ¥å£æµ‹è¯•é€šè¿‡ï¼', 'success');
            } else {
                log('âš ï¸  éƒ¨åˆ†APIæ¥å£å­˜åœ¨é—®é¢˜ï¼Œè¯·æ£€æŸ¥ä¿®å¤', 'warning');
            }
            
            // æ˜¾ç¤ºæ±‡æ€»
            showSummary();
            
            // æ¢å¤æŒ‰é’®
            document.getElementById('testBtn').disabled = false;
            document.getElementById('testBtn').textContent = 'é‡æ–°æµ‹è¯•';
        }
        
        function showSummary() {
            const summary = document.getElementById('summary');
            const successRate = ((passed / (passed + failed)) * 100).toFixed(1);
            
            summary.innerHTML = `
                <h3>ğŸ“‹ æµ‹è¯•æ±‡æ€»</h3>
                <p><strong>æ€»è®¡:</strong> ${passed + failed} ä¸ªæ¥å£</p>
                <p><strong>é€šè¿‡:</strong> <span class="success">${passed}</span> ä¸ª</p>
                <p><strong>å¤±è´¥:</strong> <span class="error">${failed}</span> ä¸ª</p>
                <p><strong>æˆåŠŸç‡:</strong> <span class="${failed === 0 ? 'success' : 'warning'}">${successRate}%</span></p>
            `;
            summary.style.display = 'block';
        }
        
        function clearOutput() {
            document.getElementById('output').innerHTML = '';
            document.getElementById('summary').style.display = 'none';
        }
    </script>
</body>
</html> 